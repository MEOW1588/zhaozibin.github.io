<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>æ‰“åœ°é¼  Â· ç»å…¸è¡—æœºç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(145deg, #2b5c42, #1d3e2c);
            font-family: 'Courier New', Courier, 'Segoe UI', monospace;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .game-container {
            max-width: 680px;
            width: 100%;
            background: #a57c4b;
            background-image: radial-gradient(circle at 20% 30%, #b8925a, #7b5834);
            border-radius: 64px 64px 48px 48px;
            box-shadow: 0 20px 30px rgba(0,0,0,0.6), inset 0 0 0 2px #ecbf7e, inset 0 0 15px #ffe1a4;
            padding: 30px 20px 40px;
            border-bottom: 10px solid #4b3621;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2d1e12;
            padding: 14px 20px;
            margin: 0 8px 30px 8px;
            border-radius: 100px;
            color: #ffddaa;
            box-shadow: inset 0 -4px 0 #0f0a06, inset 0 2px 10px #c79a4e;
            font-weight: bold;
            font-size: 1.4rem;
            text-shadow: 2px 2px 0 #3e2819;
        }

        .score-box, .timer-box {
            background: #1f130c;
            padding: 8px 22px;
            border-radius: 50px;
            border: 2px solid #e3b87c;
            box-shadow: inset 0 2px 3px black, 0 6px 0 #4a2e1e;
            letter-spacing: 2px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px 18px;
            padding: 10px;
            margin-bottom: 25px;
        }

        .hole {
            background: #3e2b1b;
            border-radius: 50%;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 8px 0px #1c130d, inset 0 12px 20px black, 0 6px 0 #2b1c12;
            border-bottom: 6px solid #624a30;
            position: relative;
            transition: 0.1s ease;
        }

        .mole {
            background: #d47b3a;
            background: radial-gradient(circle at 35% 35%, #f5b06b, #b3561e);
            width: 85%;
            height: 85%;
            border-radius: 50% 50% 45% 45%;
            box-shadow: inset 0 -6px 0 #6e2c0a, inset 0 8px 10px #ffc994, 0 8px 0 #56280e, 0 10px 15px black;
            border: 3px solid #ffb56b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: bold;
            color: #3d1e0a;
            text-shadow: 1px 3px 0 #ffbc7a;
            transform: scale(0.9);
            transition: all 0.06s cubic-bezier(0.18, 1.3, 0.6, 1);
            cursor: pointer;
            animation: pop-up 0.12s ease;
        }

        .mole:active {
            transform: scale(0.75);
            background: radial-gradient(circle at 35% 35%, #ffa726, #9e4215);
        }

        /* åœ°é¼ è¢«æ‰“ä¸­çš„ç‰¹æ•ˆ (ç¬é—´åŠ åœ¨moleä¸Š) */
        .mole-hit {
            background: white !important;
            box-shadow: 0 0 20px yellow !important;
            transition: 0.03s;
        }

        @keyframes pop-up {
            0% { transform: scale(0.2); opacity: 0; }
            100% { transform: scale(0.9); opacity: 1; }
        }

        /* ç©ºçš„æ´ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ */
        .empty-mole {
            display: none;
        }

        .control-panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 16px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .restart-btn {
            background: #fed481;
            border: none;
            border-bottom: 8px solid #b6782c;
            font-size: 1.6rem;
            font-weight: bold;
            padding: 10px 35px;
            border-radius: 60px;
            color: #362812;
            text-shadow: 2px 2px 0 #ffe3a2;
            letter-spacing: 6px;
            box-shadow: inset 0 2px 5px white, 0 8px 0 #6b431e, 0 12px 15px black;
            transition: 0.06s linear;
            cursor: pointer;
        }

        .restart-btn:active {
            border-bottom-width: 3px;
            transform: translateY(5px);
            box-shadow: inset 0 2px 5px white, 0 5px 0 #6b431e, 0 12px 15px black;
        }

        .difficulty {
            display: flex;
            gap: 6px;
            background: #251a10;
            padding: 8px 12px;
            border-radius: 50px;
            border: 2px solid #ba8b5a;
        }

        .difficulty span {
            color: #efd7b5;
            font-weight: bold;
            margin-right: 6px;
        }

        .difficulty-btn {
            background: #7a6240;
            border: none;
            border-bottom: 4px solid #3b2e1e;
            color: #ffeecd;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.04s;
            box-shadow: inset 0 1px 3px #cfb087;
        }

        .difficulty-btn.active {
            background: #f3b35e;
            border-bottom-width: 2px;
            transform: translateY(2px);
            color: #241b0c;
            border-bottom-color: #8f5f30;
            box-shadow: inset 0 3px 7px #d3923e;
        }

        .difficulty-btn:active {
            border-bottom-width: 2px;
            transform: translateY(2px);
        }

        .footer-message {
            text-align: center;
            margin-top: 20px;
            color: #ffeac2;
            font-weight: bold;
            text-shadow: 2px 2px 0 #533e24;
            letter-spacing: 2px;
            font-size: 1rem;
        }

        @media (max-width: 450px) {
            .game-container { padding: 20px 10px; }
            .grid { gap: 12px; }
            .mole { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¤´éƒ¨è®¡åˆ†æ¿ & å€’è®¡æ—¶ -->
        <div class="header">
            <div class="score-box" id="scoreDisplay">ğŸ’¯ 0</div>
            <div class="timer-box" id="timerDisplay">â³ 60</div>
        </div>

        <!-- ä¹å®«æ ¼åœ°é¼ æ´ -->
        <div class="grid" id="moleGrid">
            <!-- åŠ¨æ€ç”¨jsç”Ÿæˆ9ä¸ªæ´, ä½†ä¸ºäº†æ–¹ä¾¿ç»“æ„å¯ä»¥å†™åœ¨HTMLé‡Œ, ä½†ä¸ºäº†å¹²å‡€è¿™é‡Œç”±jsåˆ›å»º, å®¹å™¨ä¿ç•™ -->
        </div>

        <!-- æ§åˆ¶åŒºåŸŸ: é‡ç½® + éš¾åº¦ -->
        <div class="control-panel">
            <button class="restart-btn" id="restartButton">ğŸ”¨ å¼€æ‰“</button>
            <div class="difficulty">
                <span>âš¡</span>
                <button class="difficulty-btn active" data-diff="easy">ä¼‘é—²</button>
                <button class="difficulty-btn" data-diff="medium">æ­£å¸¸</button>
                <button class="difficulty-btn" data-diff="hard">ç–¯ç‹‚</button>
            </div>
        </div>
        <div class="footer-message">
            ğŸ‘Š ç‚¹å‡»åœ°é¼ å¤´ Â· è¶Šå¤šè¶Šå¿«
        </div>
    </div>

    <script>
        (function(){
            "use strict";

            // ----- æ¸¸æˆæ ¸å¿ƒçŠ¶æ€ ------
            const HOLES_COUNT = 9;          // 3x3
            let holes = [];               // å­˜å‚¨æ¯ä¸ªæ´DOMï¼ˆå®¹å™¨ .holeï¼‰
            let moleTimers = new Array(HOLES_COUNT).fill(null); // æ¯ä¸ªæ´å½“å‰çš„åœ°é¼ è®¡æ—¶å™¨
            let activeMoles = new Array(HOLES_COUNT).fill(false); // å½“å‰æ˜¯å¦æœ‰åœ°é¼ 

            // åˆ†æ•° & æ—¶é—´
            let score = 0;
            let timeLeft = 60;            // é»˜è®¤60ç§’
            let gameActive = false;       // æ¸¸æˆæ˜¯å¦è¿›è¡Œä¸­
            let countdownInterval = null;
            let spawnInterval = null;     // åˆ·åœ°é¼ ä¸»å¾ªç¯

            // éš¾åº¦å‚æ•°
            const DIFFICULTY = {
                easy: { spawnRate: 950, hideDelay: 1400, time: 60 },
                medium: { spawnRate: 650, hideDelay: 900, time: 50 },
                hard: { spawnRate: 380, hideDelay: 550, time: 40 }
            };
            let currentDifficulty = 'easy';

            // DOM å…ƒç´ 
            const gridEl = document.getElementById('moleGrid');
            const scoreEl = document.getElementById('scoreDisplay');
            const timerEl = document.getElementById('timerDisplay');
            const restartBtn = document.getElementById('restartButton');
            const diffBtns = document.querySelectorAll('.difficulty-btn');

            // ----- åˆå§‹åŒ–ç½‘æ ¼ 9ä¸ªæ´-----
            function buildGrid() {
                gridEl.innerHTML = '';
                for (let i = 0; i < HOLES_COUNT; i++) {
                    const hole = document.createElement('div');
                    hole.className = 'hole';
                    hole.dataset.index = i;
                    // å†…éƒ¨æ²¡æœ‰åœ°é¼ , åˆå§‹ä¸ºç©ºã€‚åœ°é¼ å°†åœ¨å‡ºç°æ—¶é™„åŠ  .mole å…ƒç´ 
                    gridEl.appendChild(hole);
                }
                // é‡æ–°æ•è·holes
                holes = Array.from(document.querySelectorAll('.hole'));
            }

            // ----- è¾…åŠ©: æ¸…é™¤æŸä¸ªæ´çš„åœ°é¼ ï¼ˆä¸è§¦å‘é¢å¤–å›è°ƒï¼‰-----
            function clearMoleFromHole(index) {
                const hole = holes[index];
                if (!hole) return;
                const existingMole = hole.querySelector('.mole');
                if (existingMole) {
                    existingMole.remove();
                }
                activeMoles[index] = false;
                // åŒæ—¶æ¸…é™¤è¯¥æ´çš„å»¶è¿Ÿæ¶ˆå¤±è®¡æ—¶å™¨
                if (moleTimers[index]) {
                    clearTimeout(moleTimers[index]);
                    moleTimers[index] = null;
                }
            }

            // ----- è®©æŒ‡å®šæ´å‡ºç°åœ°é¼  -----
            function showMole(index) {
                if (!gameActive) return;               // æ¸¸æˆæœªæ¿€æ´»
                if (activeMoles[index]) return;        // å·²ç»æœ‰ä¸€åªåœ°é¼ 
                const hole = holes[index];
                if (!hole) return;

                // å…ˆç¡®ä¿æ´å†…å¹²å‡€
                clearMoleFromHole(index);

                // åˆ›å»ºåœ°é¼ å…ƒç´ 
                const mole = document.createElement('div');
                mole.className = 'mole';
                mole.textContent = 'ğŸ­';   // å¯çˆ±åœ°é¼ è¡¨æƒ…
                mole.setAttribute('aria-label', 'åœ°é¼ ');

                // æ·»åŠ ç‚¹å‡»æ‰“åœ°é¼ äº‹ä»¶
                mole.addEventListener('click', (e) => {
                    e.stopPropagation();    // é˜²æ­¢äº‹ä»¶å†’æ³¡å¼‚å¸¸
                    whackMole(index);
                });

                // æ’å…¥æ´ä¸­
                hole.appendChild(mole);
                activeMoles[index] = true;

                // è®¾ç½®è®¡æ—¶å™¨ï¼šåœ°é¼ è‡ªåŠ¨æ¶ˆå¤±
                const hideTime = DIFFICULTY[currentDifficulty].hideDelay;
                const hideTimer = setTimeout(() => {
                    if (gameActive && activeMoles[index]) {
                        clearMoleFromHole(index);   // åœ°é¼ é€ƒè·‘
                    }
                }, hideTime);

                moleTimers[index] = hideTimer;
            }

            // ----- æ‰“åœ°é¼ å¤„ç† -----
            function whackMole(index) {
                if (!gameActive) return;
                if (!activeMoles[index]) return;  // æ´å·²ç»æ²¡åœ°é¼ ï¼ˆé˜²æ­¢è¿ç‚¹ï¼‰

                // åŠ åˆ†ï¼ä¸åŒéš¾åº¦åŠ ä¸åŒå€ç‡ï¼ˆè¶£å‘³ï¼‰
                let addScore = 10;
                if (currentDifficulty === 'hard') addScore = 20;
                else if (currentDifficulty === 'medium') addScore = 15;
                score += addScore;
                updateScore();

                // å‡»æ‰“ç‰¹æ•ˆï¼šç¬é—´æ·»åŠ æ ·å¼
                const hole = holes[index];
                const mole = hole.querySelector('.mole');
                if (mole) {
                    mole.classList.add('mole-hit');
                    // å¾ˆå¿«ç§»é™¤ç‰¹æ•ˆ (0.1s)
                    setTimeout(() => {
                        if (mole) mole.classList.remove('mole-hit');
                    }, 100);
                    
                    // ç«‹å³ç§»é™¤åœ°é¼ ï¼ˆæ¶ˆå¤±ï¼‰ï¼Œä¸ç»™é€ƒè·‘æœºä¼š
                    clearMoleFromHole(index);
                }
            }

            // ----- éšæœºç”Ÿæˆåœ°é¼ ï¼ˆä¸»å¾ªç¯ï¼‰-----
            function spawnRandomMole() {
                if (!gameActive) return;
                if (!holes.length) return;

                // æ‰¾å‡ºæ‰€æœ‰ç©ºç€çš„æ´
                const emptyIndices = [];
                for (let i = 0; i < HOLES_COUNT; i++) {
                    if (!activeMoles[i]) emptyIndices.push(i);
                }

                if (emptyIndices.length === 0) return; // å…¨æ»¡ï¼Œæ— æ³•ç”Ÿæˆ

                // éšæœºé€‰ä¸€ä¸ªç©ºæ´
                const randomIndex = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
                showMole(randomIndex);
            }

            // ----- æ›´æ–°UI åˆ†æ•°-----
            function updateScore() {
                scoreEl.textContent = `ğŸ’¯ ${score}`;
            }

            // ----- æ›´æ–°æ—¶é—´æ˜¾ç¤º-----
            function updateTimer() {
                timerEl.textContent = `â³ ${timeLeft}`;
                if (timeLeft <= 0) {
                    timerEl.textContent = `â³ 0`;
                }
            }

            // ----- æ¸¸æˆç»“æŸ-----
            function gameOver() {
                gameActive = false;
                // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
                if (spawnInterval) clearInterval(spawnInterval);
                if (countdownInterval) clearInterval(countdownInterval);
                spawnInterval = null;
                countdownInterval = null;

                // æ¸…é™¤æ‰€æœ‰æ´çš„åœ°é¼ ï¼Œé‡ç½®å®šæ—¶å™¨
                for (let i = 0; i < HOLES_COUNT; i++) {
                    clearMoleFromHole(i);
                }

                // åœ¨åˆ†æ•°æ—è¾¹æ˜¾ç¤ºç»“æŸæ ‡è®°ï¼ˆä¹Ÿå¯ä¸ï¼‰
                // å…¶å®ä¿ç•™åŸæœ‰åˆ†æ•°
            }

            // ----- å¼€å§‹æ–°æ¸¸æˆ-----
            function startNewGame() {
                // ç»ˆæ­¢å½“å‰æ¸¸æˆ
                gameOver();

                // é‡ç½®çŠ¶æ€
                score = 0;
                const diffConfig = DIFFICULTY[currentDifficulty];
                timeLeft = diffConfig.time;
                updateScore();
                updateTimer();

                // ç¡®ä¿æ‰€æœ‰æ´å¹²å‡€ï¼ˆäºŒæ¬¡ç¡®ä¿ï¼‰
                for (let i = 0; i < HOLES_COUNT; i++) {
                    clearMoleFromHole(i);
                }

                // æ¿€æ´»æ¸¸æˆ
                gameActive = true;

                // å¯åŠ¨å€’è®¡æ—¶
                countdownInterval = setInterval(() => {
                    if (gameActive) {
                        timeLeft--;
                        updateTimer();
                        if (timeLeft <= 0) {
                            timeLeft = 0;
                            updateTimer();
                            gameOver();  // æ—¶é—´åˆ°ï¼Œç»“æŸ
                        }
                    }
                }, 1000);

                // å¯åŠ¨ç”Ÿæˆåœ°é¼ å¾ªç¯ (æ ¹æ®éš¾åº¦é€Ÿåº¦)
                const spawnRate = DIFFICULTY[currentDifficulty].spawnRate;
                spawnInterval = setInterval(() => {
                    spawnRandomMole();
                }, spawnRate);

                // å¼€å±€é©¬ä¸Šåˆ·ä¸¤ä¸‰åªåœ°é¼ ï¼Œæ›´æœ‰ç”Ÿæ°”
                setTimeout(() => { if (gameActive) spawnRandomMole(); }, 30);
                setTimeout(() => { if (gameActive) spawnRandomMole(); }, 120);
            }

            // ----- åˆ‡æ¢éš¾åº¦-----
            function setDifficulty(diff) {
                if (diff === currentDifficulty) return;
                currentDifficulty = diff;
                
                // æŒ‰é’®æ¿€æ´»æ ·å¼
                diffBtns.forEach(btn => {
                    if (btn.dataset.diff === diff) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                // å¦‚æœæ¸¸æˆæ­£åœ¨è¿è¡Œï¼Œé‡å¼€ä¸€å±€ä»¥é€‚åº”æ–°éš¾åº¦ï¼ˆæ›´ç¬¦åˆç›´è§‰ï¼‰
                if (gameActive) {
                    startNewGame();
                } else {
                    // ä¸åœ¨æ¸¸æˆä¸­ï¼Œä½†ä¹Ÿé‡ç½®æ—¶é—´æ˜¾ç¤ºä¸ºå½“å‰éš¾åº¦æ—¶é—´
                    timeLeft = DIFFICULTY[diff].time;
                    updateTimer();
                }
            }

            // ----- äº‹ä»¶ç›‘å¬ç»‘å®š-----
            function bindEvents() {
                // é‡ç½®/å¼€å§‹æŒ‰é’®
                restartBtn.addEventListener('click', () => {
                    startNewGame();
                });

                // éš¾åº¦æŒ‰é’®
                diffBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const diff = e.currentTarget.dataset.diff;
                        setDifficulty(diff);
                    });
                });

                // æ³¨æ„ï¼šmoleç‚¹å‡»äº‹ä»¶é€šè¿‡åŠ¨æ€æ·»åŠ moleç›‘å¬å¤„ç†ï¼Œæ— éœ€å…¨å±€å§”æ‰˜ï¼ˆå·²åœ¨showMoleç»‘å®šï¼‰
                // ä½†ä¸ºé˜²æ­¢æ´å†…æ— moleè¯¯è§¦ï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚
            }

            // ----- åˆå§‹åŒ–æ¸¸æˆï¼ˆé¦–å±ä¸è‡ªåŠ¨å¼€å§‹ï¼Œä½†æ˜¾ç¤ºé™æ€æ´ï¼Œç”¨æˆ·ç‚¹å¼€æ‰“ï¼‰-----
            function initGame() {
                buildGrid();
                bindEvents();
                // é»˜è®¤æ˜¾ç¤ºä¼‘é—²éš¾åº¦æ—¶é—´
                timeLeft = DIFFICULTY.easy.time;
                updateTimer();
                score = 0;
                updateScore();
                // é»˜è®¤æœªæ¿€æ´»ï¼Œæ— åœ°é¼ ï¼Œæ˜¾ç¤ºç©ºç½‘æ ¼ã€‚ç”¨æˆ·ç‚¹å‡»â€œå¼€æ‰“â€å¼€å§‹ã€‚
                gameActive = false;
                
                // ç¡®ä¿æ‰€æœ‰æ´å¹²å‡€ï¼ˆåˆæ¬¡ï¼‰
                for (let i = 0; i < HOLES_COUNT; i++) {
                    clearMoleFromHole(i);
                }
            }

            // å¯åŠ¨åˆå§‹åŒ–
            initGame();
        })();
    </script>
</body>
</html>
